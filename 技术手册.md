 # 计算机远程监控 技术手册

 ## 网络协议

 ### 传输结构

 记总长度为n，结束符长度为m，则：

 内容|起始|结束|长度
-|-|-|-
命令类型（Command）|0|1|1
数据（Data）|1|m-n|m-n-1
结束符（SocketEnd）|m-n-1|n|m

---

### 数据格式

发送方|类别|内容|命令|内容格式|对应Model
-|-|-|-|-|-
客户端|请求|登录|```C_Login```|Json|Client
S|反馈|登陆反馈|```S_LoginFeedback```|Json|User
客户端|请求|请求屏幕监控|```Client_AskForScreen```|Json|

---

### 传输步骤


#### 登录

序号|目的|发送方|接收方|命令
-|-
1|告知S有新客户端上线， 并尝试登录|C|S|```C_Login```
2|反馈登录的结果|S|C|```S_LoginFeedback```

### 屏幕监控

屏幕监控时，当服务端收到被控端发来的图像时，需要等待图像成功转发到所有连接的控制端之后，才向被控端发送“可继续发送”指令，被控端才可继续截取屏幕。

当多个客户端请求控制同一个客户端时，该客户端仅会创建一个屏幕截取实例

序号|目的|发送次数|发送方|命令|介绍|内容|内容格式|
-|-|-|-
1|请求控制被控端|单次|A|B|```Screen_AskForStartScreen```
2|发送屏幕数据|多次|B|A|```Screen_NewScreen```|图像|byte[]
3|请求下一张屏幕|多次|S|B|```Screen_AskForNextScreen```
4|请求停止控制被控端|单次|A|B|```Screen_AskForStopScreen```

### 系统硬件信息

以下所有命令均经过服务器转发

序号|目的|发送次数|发送方|接收方|命令|内容|内容格式|
-|-
1|请求WMI命名空间|单次|A|B|```WMI_AskForNamespaces```
2|回发WMI命名空间|多次|B|A|```WMI_Namespace```|命名空间列表|string[]
3|请求WMI类|单次|A|B|```WMI_AskForClasses```|指定的命名空间|string
4|回发WMI类|单次|B|A|```WMI_Classes```|类列表|WMIClassInfo[]
5|请求WMI类|单次|A|B|```WMI_AskForProps```|指定的命名空间和类|WMIClassInfo
6|回发WMI类|单次|B|A|```WMI_Props```|WMI对象列表|WMIObjectCollection